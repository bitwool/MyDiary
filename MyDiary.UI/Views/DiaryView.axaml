<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MyDiary.UI.ViewModels"
             xmlns:views="clr-namespace:MyDiary.UI.Views"
             xmlns:avaloniaEdit="https://github.com/avaloniaui/avaloniaedit"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="MyDiary.UI.Views.DiaryView"
             x:DataType="vm:DiaryViewModel">

    <Design.DataContext>
        <vm:DiaryViewModel />
    </Design.DataContext>

    <Grid ShowGridLines="True">
        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" IsVisible="{Binding !IsWorkspaceSet}">
            <TextBlock Text="请选择或创建一个工作区" Margin="0,0,0,10" />
            <Button Command="{Binding SelectWorkspaceCommand}">选择工作区</Button>
        </StackPanel>
        <Grid ColumnDefinitions="170, *" IsVisible="{Binding IsWorkspaceSet}">
            <TreeView Grid.Column="0" ItemsSource="{Binding TreeNodes}"
                      SelectionChanged="TreeView_OnSelectionChanged"
                      DoubleTapped="TreeView_DoubleTapped">
                <TreeView.ItemTemplate>
                    <TreeDataTemplate ItemsSource="{Binding Children}">
                        <TextBlock Text="{Binding Name}" />
                    </TreeDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>

            <TabControl Grid.Column="1" ItemsSource="{Binding OpenDiaries}"
                        SelectedItem="{Binding SelectedDiary}">
                <TabControl.ItemTemplate>
                    <DataTemplate x:DataType="vm:EditorViewModel">
                        <DockPanel>
                            <Button DockPanel.Dock="Right"
                                    Command="{Binding $parent[TabControl].((vm:DiaryViewModel)DataContext).CloseDiaryCommand}"
                                    CommandParameter="{Binding}"
                                    Content="x"
                                    FontSize="12"
                                    Width="20" Height="20"
                                    Margin="5,0,0,0"
                                    VerticalContentAlignment="Center"
                                    HorizontalContentAlignment="Center"
                                    Padding="0"
                                    BorderThickness="0"
                                    Background= "Transparent" />
                            <TextBlock Text="{Binding DiaryEntry.Header}" />
                        </DockPanel>
                    </DataTemplate>
                </TabControl.ItemTemplate>
                <!-- <TabControl.ContentTemplate> -->
                <!--     <DataTemplate x:DataType="vm:EditorViewModel"> -->
                <!--         <views:EditorView /> -->
                <!--     </DataTemplate> -->
                <!-- </TabControl.ContentTemplate> -->
            </TabControl>
        </Grid>
    </Grid>


</UserControl>